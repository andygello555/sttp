\section{Four Function Calculator}
\label{sec:four-func-calculator}

In order to get used to the Go and the participle parser generator, I created a simple four function calculator interpreter. The interpreter supports addition, subtraction, multiplication, division and variable assignment.

The interpreter was straightforward in implementation. Participle allows you to embed your language grammar within the nodes that your AST will be constructed from via Go \verb|struct| field annotations. This makes your grammar and AST structure quite readable and easily modifiable. Using Go referral functions, you can then easily define evaluation functions for each node which effectively `walks' the produced AST. For instance here is the AST node and evaluation function for a statement within the four function language.

\begin{minted}{go}
// Statement can either be an expression, variable assignment or variable clear.
// The EBNF for this non-terminal:
//  ( Clear | Assignment | Expression ) ( EOL | ";" | EOF )
type Statement struct {
    // Pointer to Clear statement node. Can be nil.
    Clear      *Clear      `(   @@`  // "@@" denotes the capture of the type 
                                     // of the field. In this case the Clear
                                     // non-terminal.

    // Pointer to Assignment statement node. Can be nil.
    Assignment *Assignment `  | @@`

    // Pointer to Expression statement node. Can be nil.
    // EOL and EOF are passed into the parser from lexer.
    // Each statement can be finished by either an EOL, semicolon or EOF.
    Expression *Expression `  | @@ ) (EOL | ";" | EOF)`
}

// Each node implements the same Eval function signature.
// This means each node implements an interface which defines
// such a signature.
// The Memory type is a map containing the current values of each defined
// variable and is passed to each Eval function.
func (s *Statement) Eval(ctx Memory) (float64, *Memory) {
    // Nil switch as we have three alternates.
    switch {
    case s.Clear != nil:
        s.Clear.Eval(ctx)
        return 0, &ctx
    case s.Assignment != nil:
        s.Assignment.Eval(ctx)
        return 0, &ctx
    }
    return s.Expression.Eval(ctx), &ctx
}
\end{minted}

The four function calculator can be run in an interactive line-by-line mode, as well as executing scripts directly. The following is an example script:

\begin{center}
    \begin{verbatim}
        let a=3*3
        let b=a*2;(a+b)/2
        clear a
        let a=b*2
        a+b
    \end{verbatim}
\end{center}

See the README on instructions on how to run the four function calculator interpreter.

\section{Regex parser}

After implementing the \hyperref[sec:four-func-calculator]{four function calculator interpreter} I was a week ahead of my project plan. At the start of October, I was covering content related to the construction of minimal DFA from regular expressions in CS3470. I found the algorithms involved in constructing these DFAs interesting, so I decided to write my own implementation of them.

I wrote a grammar which accepts a language for simple regular expressions (concatentation, alternation, grouping, and Kleene Closure), which I then implemented within Go and participle. The produced parser constructs an AST which is then walked to construct an NFA using Thompson's construction. The subset construction is then applied to this NFA to produce a DFA. Finally, this DFA is run through the Dead State Minimisation algorithm to produce a minimal DFA. Each step of this construction produces a \href{https://graphviz.org/}{graphviz} dot file and a bitmap of the rendered graph.

\begin{figure}[H]
    \centering
    \begin{subfigure}{.333\textwidth}
        \centering
        \resizebox{4.2em}{24em}{
        \begin{tikzpicture}[>=latex',line join=bevel,]
            \pgfsetlinewidth{1bp}
          %%
          \pgfsetcolor{black}
            % Edge: 2 -> 3
            \draw [->] (52.486bp,189.98bp) .. controls (51.471bp,184.29bp) and (50.502bp,177.9bp)  .. (50.0bp,172.0bp) .. controls (49.355bp,164.42bp) and (49.841bp,156.22bp)  .. (52.288bp,138.64bp);
            \definecolor{strokecol}{rgb}{0.0,0.0,0.0};
            \pgfsetstrokecolor{strokecol}
            \draw (40.5bp,164.5bp) node {\Huge a};
            % Edge: 4 -> 5
            \draw [->] (28.808bp,276.89bp) .. controls (28.324bp,233.88bp) and (27.051bp,120.51bp)  .. (26.284bp,52.242bp);
            \draw (16.0bp,164.5bp) node {\Huge $\epsilon$};
            % Edge: 1 -> 4
            \draw [->] (29.0bp,363.8bp) .. controls (29.0bp,352.16bp) and (29.0bp,336.55bp)  .. (29.0bp,313.18bp);
            \draw (40.0bp,338.5bp) node {\Huge $\epsilon$};
            % Edge: 3 -> 2
            \draw [->] (56.0bp,139.18bp) .. controls (56.0bp,150.81bp) and (56.0bp,166.42bp)  .. (56.0bp,189.8bp);
            \draw (67.0bp,164.5bp) node {\Huge $\epsilon$};
            % Edge: 0 -> 1
            \draw [->] (29.0bp,450.8bp) .. controls (29.0bp,439.16bp) and (29.0bp,423.55bp)  .. (29.0bp,400.18bp);
            \draw (38.5bp,425.5bp) node {\Huge a};
            % Edge: 3 -> 5
            \draw [->] (50.637bp,103.37bp) .. controls (46.83bp,91.572bp) and (41.587bp,75.32bp)  .. (33.798bp,51.175bp);
            \draw (57.0bp,77.5bp) node {\Huge $\epsilon$};
            % Edge: 4 -> 2
            \draw [->] (34.206bp,277.61bp) .. controls (38.016bp,265.62bp) and (43.265bp,249.09bp)  .. (50.81bp,225.34bp);
            \draw (57.0bp,251.5bp) node {\Huge $\epsilon$};
            % Node: 1
          \begin{scope}
            \definecolor{strokecol}{rgb}{0.0,0.0,0.0};
            \pgfsetstrokecolor{strokecol}
            \draw (29.0bp,382.0bp) ellipse (18.0bp and 18.0bp);
            \draw (29.0bp,382.0bp) node {1};
          \end{scope}
            % Node: 0
          \begin{scope}
            \definecolor{strokecol}{rgb}{0.0,0.0,0.0};
            \pgfsetstrokecolor{strokecol}
            \draw (29.0bp,469.0bp) ellipse (18.0bp and 18.0bp);
            \draw (29.0bp,469.0bp) node {0};
          \end{scope}
            % Node: 3
          \begin{scope}
            \definecolor{strokecol}{rgb}{0.0,0.0,0.0};
            \pgfsetstrokecolor{strokecol}
            \draw (56.0bp,121.0bp) ellipse (18.0bp and 18.0bp);
            \draw (56.0bp,121.0bp) node {3};
          \end{scope}
            % Node: 2
          \begin{scope}
            \definecolor{strokecol}{rgb}{0.0,0.0,0.0};
            \pgfsetstrokecolor{strokecol}
            \draw (56.0bp,208.0bp) ellipse (18.0bp and 18.0bp);
            \draw (56.0bp,208.0bp) node {2};
          \end{scope}
            % Node: 5
          \begin{scope}
            \definecolor{strokecol}{rgb}{0.0,0.0,0.0};
            \pgfsetstrokecolor{strokecol}
            \draw (26.0bp,26.0bp) ellipse (22.0bp and 22.0bp);
            \draw (26.0bp,26.0bp) ellipse (26.0bp and 26.0bp);
            \draw (26.0bp,26.0bp) node {5};
          \end{scope}
            % Node: 4
          \begin{scope}
            \definecolor{strokecol}{rgb}{0.0,0.0,0.0};
            \pgfsetstrokecolor{strokecol}
            \draw (29.0bp,295.0bp) ellipse (18.0bp and 18.0bp);
            \draw (29.0bp,295.0bp) node {4};
          \end{scope}
          %
          \end{tikzpicture}
        }
        \caption{NFA}
    \end{subfigure}%
    \begin{subfigure}{.333\textwidth}
        \centering
        \resizebox{12em}{20em}{
            \begin{tikzpicture}[>=latex',line join=bevel,]
                \pgfsetlinewidth{1bp}
              %%
              \pgfsetcolor{black}
                % Edge: [2 3 5] -> [2 3 5]
                \draw [->] (103.55bp,35.098bp) .. controls (113.96bp,34.208bp) and (121.5bp,31.176bp)  .. (121.5bp,26.0bp) .. controls (121.5bp,22.684bp) and (118.4bp,20.248bp)  .. (103.55bp,16.902bp);
                \definecolor{strokecol}{rgb}{0.0,0.0,0.0};
                \pgfsetstrokecolor{strokecol}
                \draw (135.0bp,26.0bp) node {\Large a};
                % Edge: [0] -> [1 2 4 5]
                \draw [->] (55.5bp,205.94bp) .. controls (55.5bp,194.58bp) and (55.5bp,179.22bp)  .. (55.5bp,155.01bp);
                \draw (69.0bp,180.5bp) node {\Large a};
                % Edge: [1 2 4 5] -> [2 3 5]
                \draw [->] (55.5bp,102.77bp) .. controls (55.5bp,90.603bp) and (55.5bp,75.792bp)  .. (55.5bp,52.254bp);
                \draw (69.0bp,77.5bp) node {\Large a};
                % Node: [2 3 5]
              \begin{scope}
                \definecolor{strokecol}{rgb}{0.0,0.0,0.0};
                \pgfsetstrokecolor{strokecol}
                \draw (99.5bp,16.89bp) -- (99.5bp,35.11bp) -- (73.73bp,48.0bp) -- (37.27bp,48.0bp) -- (11.5bp,35.11bp) -- (11.5bp,16.89bp) -- (37.27bp,4.0bp) -- (73.73bp,4.0bp) -- cycle;
                \draw (103.5bp,14.42bp) -- (103.5bp,37.58bp) -- (74.67bp,52.0bp) -- (36.33bp,52.0bp) -- (7.5bp,37.58bp) -- (7.5bp,14.42bp) -- (36.33bp,0.0bp) -- (74.67bp,0.0bp) -- cycle;
                \draw (55.5bp,26.0bp) node {[2 3 5]};
              \end{scope}
                % Node: [0]
              \begin{scope}
                \definecolor{strokecol}{rgb}{0.0,0.0,0.0};
                \pgfsetstrokecolor{strokecol}
                \draw (82.5bp,216.54bp) -- (82.5bp,231.46bp) -- (66.68bp,242.0bp) -- (44.32bp,242.0bp) -- (28.5bp,231.46bp) -- (28.5bp,216.54bp) -- (44.32bp,206.0bp) -- (66.68bp,206.0bp) -- cycle;
                \draw (55.5bp,224.0bp) node {[0]};
              \end{scope}
                % Node: [1 2 4 5]
              \begin{scope}
                \definecolor{strokecol}{rgb}{0.0,0.0,0.0};
                \pgfsetstrokecolor{strokecol}
                \draw (107.0bp,119.89bp) -- (107.0bp,138.11bp) -- (76.83bp,151.0bp) -- (34.17bp,151.0bp) -- (4.0bp,138.11bp) -- (4.0bp,119.89bp) -- (34.17bp,107.0bp) -- (76.83bp,107.0bp) -- cycle;
                \draw (111.0bp,117.25bp) -- (111.0bp,140.75bp) -- (77.65bp,155.0bp) -- (33.35bp,155.0bp) -- (0.0bp,140.75bp) -- (0.0bp,117.25bp) -- (33.35bp,103.0bp) -- (77.65bp,103.0bp) -- cycle;
                \draw (55.5bp,129.0bp) node {[1 2 4 5]};
              \end{scope}
              %
            \end{tikzpicture}
        }
        \caption{DFA}
    \end{subfigure}%
    \begin{subfigure}{.333\textwidth}
        \centering
        \resizebox{7em}{10em}{
            \begin{tikzpicture}[>=latex',line join=bevel,]
                \pgfsetlinewidth{1bp}
              %%
              \pgfsetcolor{black}
                % Edge: 2 -> 1
                \draw [->] (26.0bp,102.94bp) .. controls (26.0bp,91.576bp) and (26.0bp,76.224bp)  .. (26.0bp,52.014bp);
                \definecolor{strokecol}{rgb}{0.0,0.0,0.0};
                \pgfsetstrokecolor{strokecol}
                \draw (39.5bp,77.5bp) node {\Large a};
                % Edge: 1 -> 1
                \draw [->] (50.434bp,35.263bp) .. controls (60.975bp,36.021bp) and (70.0bp,32.934bp)  .. (70.0bp,26.0bp) .. controls (70.0bp,21.45bp) and (66.113bp,18.556bp)  .. (50.434bp,16.737bp);
                \draw (83.5bp,26.0bp) node {\Large a};
                % Node: 1
              \begin{scope}
                \definecolor{strokecol}{rgb}{0.0,0.0,0.0};
                \pgfsetstrokecolor{strokecol}
                \draw (26.0bp,26.0bp) ellipse (22.0bp and 22.0bp);
                \draw (26.0bp,26.0bp) ellipse (26.0bp and 26.0bp);
                \draw (26.0bp,26.0bp) node {1};
              \end{scope}
                % Node: 2
              \begin{scope}
                \definecolor{strokecol}{rgb}{0.0,0.0,0.0};
                \pgfsetstrokecolor{strokecol}
                \draw (26.0bp,121.0bp) ellipse (18.0bp and 18.0bp);
                \draw (26.0bp,121.0bp) node {2};
              \end{scope}
              %
            \end{tikzpicture}
        }
        \caption{Minimised DFA}
    \end{subfigure}
    \cprotect\caption{\label{fig:1.1}This produces the following graphs for the given input: \verb+aa|ba(e|c)+. \textit{Note that the }\verb|e|\textit{ represents $\epsilon$ (epsilon)}.}
\end{figure}

\section{Simple Web-API}

I decided whilst writing the project plan, that writing a simple web-API server would come in useful when testing \verb|sttp|. The web server is written using \href{https://nodejs.org/en/}{node.js} as it was well suited for this task and I have had some experience with it. I implemented a very simple echo-chamber web-API server which responds to each HTTP request with information about the incoming request. The following are some example requests and responses:

\begin{figure}[H]
    \centering
    \begin{subfigure}{.5\textwidth}
        \centering
        \begin{mdframed}
            \begin{Verbatim}[fontsize=\scriptsize]
GET 127.0.0.1:3000?hello=world

{
    "code": null,
    "headers": {
        "accept": "*/*",
        "accept-encoding": "gzip, deflate",
        "connection": "keep-alive",
        "host": "127.0.0.1:3000",
        "user-agent": "HTTPie/2.6.0"
    },
    "method": "GET",
    "query_params": {
        "hello": "world"
    },
    "url": "http://127.0.0.1:3000/?hello=world",
    "version": "1.1"
}
            \end{Verbatim}
        \end{mdframed}
    \end{subfigure}%
    \begin{subfigure}{.5\textwidth}
        \centering
        \begin{mdframed}            
            \begin{Verbatim}[fontsize=\scriptsize]
POST 127.0.0.1:3000/helloworld {"hello": "world"}

{
    "body": {
        "hello": "world"
    },
    "code": null,
    "headers": {
        "accept": "application/json, */*;q=0.5",
        "accept-encoding": "gzip, deflate",
        "connection": "keep-alive",
        "content-length": "18",
        "content-type": "application/json",
        "host": "127.0.0.1:3000",
        "user-agent": "HTTPie/2.6.0"
    },
    "method": "POST",
    "query_params": {},
    "url": "http://127.0.0.1:3000/helloworld",
    "version": "1.1"
}
            \end{Verbatim}
        \end{mdframed}
    \end{subfigure}
    \cprotect\caption{\label{fig:1.2}Examples of requests and responses to and from the Simple Web-API. \textit{Note this assumes that the server is running on }\verb|127.0.0.1:3000|\textit{.}}
\end{figure}
