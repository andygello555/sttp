// Fetch blogs so that we can use the retrieve action on one of them
blogs = $GET("http://127.0.0.1:8000/api/blogs");

for _, blog in blogs.content do
    // Get all comments
    comments = $GET("http://127.0.0.1:8000/api/blogs/%%/comments" % blog.id);
    for _, comment in comments.content do
        new_body = comment.body + " Updated";
        comment_resp = $PATCH(
            "http://127.0.0.1:8000/api/comments/%%" % comment.id,
            {"body": new_body}
        );
        test comment_resp.code == 200;
        test comment_resp.content.body == new_body;
    end;
end;
