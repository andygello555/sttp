// We have to create some blogs for each topic to test this endpoint.
// We do this by iterating over each topic and creating blogs for them.
topics = $GET("http://127.0.0.1:8000/api/topics");
topics_no = 0 + topics.content;

batch this
    for i, topic in topics.content do
        // Create (topics_no - i) blogs for the topic
        for j = topics_no - i; j > 0; j = j - 1 do
            blog_resp = $POST("http://127.0.0.1:8000/api/blogs", {
                "name": "Test Blog for %%, No %%" % [topic.name, j],
                "body": "Blah Blah",
                "author": "Jane Doe",
                "tags": [topic.name, "Test"],
                "topic_id": topic.id
            });
        end;
    end;
end;

// Get the top 10 topics by blog_count
top_10 = $GET("http://127.0.0.1:8000/api/topics/top");

// Check if it is what we expected...
for i, topic in top_10.content do
    test topic.blog_count == 3 - i;
    test topic.name == "Test Topic %% Updated" % (i + 1);
end;
